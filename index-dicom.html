<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Synthetic M-mode</title>
    <meta name="description" content="The frontend of the Synthetic M-mode project">
    <meta name="author" content="Magnus Dalen KvalevÃ¥g">

    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
        }

        canvas {
            display: block;
        }

        .hidden {
            display: none
        }
    </style>
</head>

<body>
    <label>Select a DICOM file:</label>
    <input id="fileSelect" type="file"></input>

    <p id="info"></p>
    <canvas id="videoCanvas"></canvas>
    <canvas id="mModeCanvas"></canvas>

    <script src="https://unpkg.com/cornerstone-core/dist/cornerstone.min.js"></script>
    <script src="https://unpkg.com/dicom-parser"></script>
    <script src="https://unpkg.com/cornerstone-wado-image-loader@3.3.1/dist/cornerstoneWADOImageLoader.min.js"></script>
    <script src="js/util.js"></script>
    <script src="js/images.js"></script>
    <script src="js/spritesheet.js"></script>
    <script src="js/main.js"></script>
    <script src="js/dicom.js"></script>

    <script>
        async function handleFileSelected(e) {
            const file = e.target.files[0]; // User should only select one file, not a directory.
            const loadedImages = await loadDicomAsCornerstoneImages(file);

            start(
                document.getElementById("videoCanvas"),
                document.getElementById("mModeCanvas"),
                loadedImages,
                {},
                { "onLineChange": onLineChange }
            )
        }


        cornerstoneWADOImageLoader.external.cornerstone = cornerstone;
        const fileSelectElement = document.getElementById("fileSelect");
        fileSelectElement.addEventListener('change', handleFileSelected);


        const infoElement = document.getElementById("info");

        function onLineChange(state) {
            infoElement.innerHTML = `
        Start = (${state['startX']}, ${state['startY']}).
        End = (${state['endX']}, ${state['endY']}).
        Length = ${Math.floor(distance(state['startX'], state['startY'], state['endX'], state['endY']))}
        `
        }
    </script>
</body>

</html>